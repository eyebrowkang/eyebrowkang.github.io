<!doctype html><html lang=zh dir=auto><head><meta name=generator content="Hugo 0.112.5"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Share Some Tech</title><meta name=description content="share some technology things"><meta name=author content="eyebrowkang"><link rel=canonical href=https://tech.eyebrowkang.com/><link crossorigin=anonymous href=/assets/css/stylesheet.d918aa2b3672274a508449848c9e6fcc030030e995cea61623654add81dfe9a7.css integrity="sha256-2RiqKzZyJ0pQhEmEjJ5vzAMAMOmVzqYWI2VK3YHf6ac=" rel="preload stylesheet" as=style><link rel=icon href=https://static.eyebrowkang.com/eyebrow.png><link rel=icon type=image/png sizes=16x16 href=https://tech.eyebrowkang.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tech.eyebrowkang.com/favicon-32x32.png><link rel=apple-touch-icon href=https://static.eyebrowkang.com/eyebrow.png><link rel=mask-icon href=https://static.eyebrowkang.com/eyebrow.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://tech.eyebrowkang.com/index.xml><link rel=alternate type=application/json href=https://tech.eyebrowkang.com/index.json><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Share Some Tech"><meta property="og:description" content="share some technology things"><meta property="og:type" content="website"><meta property="og:url" content="https://tech.eyebrowkang.com/"><meta property="og:image" content="https://tech.eyebrowkang.com/blog-cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tech.eyebrowkang.com/blog-cover.png"><meta name=twitter:title content="Share Some Tech"><meta name=twitter:description content="share some technology things"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Share Some Tech","url":"https://tech.eyebrowkang.com","description":"share some technology things","thumbnailUrl":"https://static.eyebrowkang.com/eyebrow.png","sameAs":["https://github.com/eyebrowkang","https://twitter.com/EyebrowKang","index.xml"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tech.eyebrowkang.com accesskey=h title="Share Some Tech (Alt + H)">Share Some Tech</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tech.eyebrowkang.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://tech.eyebrowkang.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://tech.eyebrowkang.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2>axios源码解析（二）</h2></header><div class=entry-content><p>下面我们来研究一下拦截器是什么？还是lib/core/Axios这个文件的同名函数中，我们在进行整体梳理的时候刻意忽略了一些条件语句中的内容，其中一部分是 interceptors，中文为拦截器，这个属性的初始化是在最开始的函数体内部，通过 new 这个操作符创建了一个 InterceptorManager 的实例，那么我们就先看看这个函数里面是什么样子的。
拦截器长什么样子 打开lib/core/InterceptorManager.js这个文件，可以看到是非常简单的一个函数，函数体内只有一个handlers属性，初始值是一个空数组，下面是三个添加到函数原型上的方法。
首先是use方法，接收三个参数，结合上面的注释可以看出来这个方法是将一个对象推入handlers数组，然后返回一个数字，这个数字就是对象的 index，而这个对象中有四个键值对，其中前两个分别用于处理 Promise 成功和失败的情况，synchronous字面理解是用于判断是否同步，而runWhen看不出来，先继续向下看。
然后是eject方法，这个方法只接收一个参数，就是前面 use 方法的返回值，即 push 进数组的那个对象的 index，如果这个对象还存在就将其置为 null，相当于移除掉了它。
最后是forEach方法，由于这里面引用了自定义的工具函数utils.forEach，所以我们要跳转过去简单看下这个函数，它接收两个参数，主要逻辑在最后一个 if else 语句中，如果第一个参数是数组，就对其进行遍历，每遍历一次就执行一次第二个参数传入的函数，并且给这个函数传入三个参数，分别是当前元素，当前元素的 index，当前数组；经过前两个 if 块的筛选之后，如果说第一个参数不是数组，那么它就是一个对象，同样对这个对象进行迭代，也是每迭代一次执行一次 fn，fn 的三个参数分别是当前键值对的值，当前键值对的键，和对象自身。下面回到拦截器的 forEach 方法，它接收一个函数，然后对 handlers 进行遍历，如果 h 也就是遍历的当前元素是存在的，也即没有被 eject，那么就以这个元素为唯一参数执行传入的函数。这个元素一定是通过 use 方法 push 进来的那个具有四个键值对的对象。
拦截器如何处理请求 我们可以通过查看官方示例来了解拦截器最简单的使用方法，可以看到，通过 use 方法添加拦截器，两个函数fulfilled和rejected对应请求发出前和请求出错时的处理情况，通过 eject 方法来移除对应的拦截器。到这里，我们大概可以明白，拦截器是用于在请求发出前对请求进行一个处理，那么具体怎么处理呢？
处理用户添加的拦截器 我们回到源码，lib/core/Axios.js文件中，找到requestInterceptorChain这里，这是我们上篇文章略过的地方之一，下面我们看下代码。
请求拦截器的处理：开头定义了两个变量，requestInterceptorChain是一个空数组，synchronousRequestInterceptors是一个初始值为 true 的布尔类型变量。接着调用了拦截器的 forEach 方法，这会对handlers数组中（通过 use 方法添加）的所有拦截器进行遍历，如果这个拦截器存在(没有被 eject)，将以其为参数执行unshiftRequestInterceptors函数。我们看这个函数的内容，可以通过 if 判断中的条件推测出来，runWhen 类似一个检测函数，这个函数默认是不存在的，如果你设置了 runWhen 函数，并且你的配置项不能通过检测，那么在这里拦截器就不会被添加到requestInterceptorChain数组中，也就相当于没有设置拦截器。由于上篇文章就是按照没有拦截器梳理的，我们下面按照拦截器存在来继续看，接着是synchronousRequestInterceptors变量，保持了和当前拦截器中的synchronous属性一致，默认为 false 即异步，最后将这个拦截器的 fulfilled 方法和 rejected 方法依此添加到requestInterceptorChain数组的开头，也就是说如果你设置了多个拦截器，那么最后设置的拦截器会在requestInterceptorChain数组的最前方。例如，你依次添加了 interceptors1, interceptors2 两个拦截器，那么，在requestInterceptorChain数组中元素依次是 interceptors2.fulfilled, interceptors2....</p></div><footer class=entry-footer><span title='2022-05-16 21:03:37 +0800 CST'>五月 16, 2022</span>&nbsp;·&nbsp;eyebrowkang</footer><a class=entry-link aria-label="post link to axios源码解析（二）" href=https://tech.eyebrowkang.com/posts/2022-05-16-axios%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BA%8C/></a></article><article class=post-entry><header class=entry-header><h2>axios源码解析（一）</h2></header><div class=entry-content><p>关于 axios 是什么，以及它的基本使用不在此赘述，可以参考axios 官方文档，非常的详细，这里主要针对 axios 的源码进行解析。本文撰写时的 commit 为bc733fec78326609e751187c9d453cee9bf1993a
代码目录结构 首先我们可以从axios 的 github 仓库获取到其源码，在深入代码之前，我们先看一下这个项目的目录结构：
├── .github //github相关文件夹，包括issue模板、PR模板等 ├── dist //axios最新的版本文件，从npm、cdn等获取到的最新版本即是此处文件 ├── examples //axios官方给出的一些例子 ├── lib //最主要的源码部分 ├── sandbox //也是一个简单的例子，可以在sandbox中运行 ├── test //测试各种功能的代码 ├── .eslintrc.js //eslint配置文件 ├── .gitignore //git的忽略文件 ├── .npmignore //npm打包发布的忽略文件 ├── .travis.yml //travis流水线配置文件 ├── CHANGELOG.md //版本变更日志 ├── CODE_OF_CONDUCT.md //贡献者的一些公约 ├── COLLABORATOR_GUIDE.md //提issue、PR等的一些指南 ├── CONTRIBUTING.md //给想要参与贡献和开发人员的具体的技术指导 ├── COOKBOOK.md //axios配合其他库实现强大功能的示例 ├── ECOSYSTEM.md //axios的相关npm包 ├── Gruntfile.js //grunt（一个自动化工具）的配置文件 ├── LICENSE //开源协议 ├── README.md //仓库的说明 ├── SECURITY....</p></div><footer class=entry-footer><span title='2022-05-03 21:03:27 +0800 CST'>五月 3, 2022</span>&nbsp;·&nbsp;eyebrowkang</footer><a class=entry-link aria-label="post link to axios源码解析（一）" href=https://tech.eyebrowkang.com/posts/2022-05-03-axios%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%80/></a></article><article class=post-entry><header class=entry-header><h2>结合React上手esbuild（新手适用）</h2></header><div class=entry-content><p>我们都知道 react 有一个官方的脚手架 create-react-app，一条命令就可以让你使用 react 编写代码，但是在这个脚手架中 react 代码的打包过程对我们是完全隐藏的。
对于一个新手来说，比如我刚接触到这个工具的时候是充满了疑惑的，为什么我不能npm install react react-dom然后直接使用script标签引入呢？为什么这些代码要打包才可以使用？打包很复杂吗？怎么进行打包呢？
上面这些问题我们暂且不做回答，下面直接使用 esbuild 这个打包工具，带大家从零开始制作一个简单的 react 页面。
esbuild 是一个比较新的打包工具，这里是它的官方文档，相较于 create-react-app 使用的 webpack 而言，它的优点是快，缺点是不支持 css module 等特性。当然了，如果你一定要使用 css module 的话，那么很抱歉这篇文章不能帮助到你
开始动手 1. 初始化 确定你已经安装好了node和npm，然后打开电脑的命令行，新建一个文件夹，并运行npm init -y
2. 安装依赖 安装需要用到的依赖，我们会用到react react-dom esbuild这三个包
3. 新建文件 打开你的 vs code 或者其他编辑器，新建一个 html 文件，以及一个 src 文件夹（包含一个 css 文件和一个 jsx 文件）
4. 写代码 在你的 jsx 和 css 中随便写点什么
import React from "react"; import ReactDOM from "react-dom"; import "....</p></div><footer class=entry-footer><span title='2021-07-07 16:58:24 +0800 CST'>七月 7, 2021</span>&nbsp;·&nbsp;eyebrowkang</footer><a class=entry-link aria-label="post link to 结合React上手esbuild（新手适用）" href=https://tech.eyebrowkang.com/posts/2021-07-07-%E7%BB%93%E5%90%88react%E4%B8%8A%E6%89%8Besbuild%E6%96%B0%E6%89%8B%E9%80%82%E7%94%A8/></a></article><article class=post-entry><header class=entry-header><h2>Vite vs Webpack vs Esbuild</h2></header><div class=entry-content><p>本篇文章分享下题目中三种打包工具在开发和生产模式中的实际使用感受，希望能对你有所帮助。我使用的技术栈是react+typescript+express，开发模式使用打包工具自带的开发服务器，生产模式使用一个简单的 express 服务器，代码放在这里GitHub。由于本文目的是对比，因此对于配置项的详细介绍以及具体代码就省略掉了，需要的可以自行查看官方文档（vite、webpack、esbuild）。
配置文件 Typtescript 支持 vite 和 webpack 均支持*.config.ts格式的配置文件，而 esbuild 由于没有对应的cli启动工具，因此其需要使用node *.js命令来启动，因此不适合使用 ts。
开发模式 开发模式的对比项目主要包括配置难度、启动速度、热更新及路由的配置三个项目。
配置难度 vite: 最简单，几乎零配置。vite 官方有许多模版可以直接使用，但即使不用模版，你只需要配置一个 react 热更新插件就足够了。不过，如果你使用的框架没有对应插件，或者你不希望使用默认的配置，那么你就需要仔细阅读文档，并且你需要同时学习 vite 和 rollup 甚至 esbuild 的文档，才能够随心所欲的配置。 esbuild: 比较简单。esbuild 的配置项并不多，你只需要增加一个 servedir 就可以使用它的开发服务器了。 webpack: 比较复杂。这里我使用的是 webpack5，只进行最基础的配置和代码分割优化，但是仍然需要安装一大堆的第三方包。其余的配置都需要根据文档一步步进行配置，对于新手并不是特别友好。另外，由于 ts-loader 实在太慢，我这里使用了 esbuild-loader（应该是最快加载 ts 文件的 loader 了）。 启动速度（使用相同的代码及入口） esbuild: 最快。 vite: 比 esbuild 慢近 10 倍，但实际感知不强，依然非常的快。 webpack: 比 vite 慢 10 倍有余，实际能感知，需要等待。 热更新及react-router路由配置 vite: 配置官方插件后支持热更新及react-router webpack: 热更新需要在 devServer 中开启，react-router也需要进行配置。 esbuild: 开发服务器不支持热更新，不支持react-router配置 生产模式 生产模式主要对比代码分离和速度两个项目。其配置难度可以参考开发模式，另外，实际三个打包工具都可以将开发模式和生产模式的配置集成在一个配置文件中，但是这里为了对比，我分别写了开发和生产的配置文件。
代码分离 和 打包速度 esbuild: 速度最快，但代码分离效果最差。可以看到，最大的 js 文件有 4....</p></div><footer class=entry-footer><span title='2020-09-05 15:00:00 +0800 CST'>九月 5, 2020</span>&nbsp;·&nbsp;eyebrowkang</footer><a class=entry-link aria-label="post link to Vite vs Webpack vs Esbuild" href=https://tech.eyebrowkang.com/posts/2020-09-05-vite_vs_webpack_vs_esbuild/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://tech.eyebrowkang.com/>«&nbsp;上一页&nbsp;</a></nav></footer></main><footer class=footer><span>&copy; 2023 <a href=https://tech.eyebrowkang.com>Share Some Tech</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>