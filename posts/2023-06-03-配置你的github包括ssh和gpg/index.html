<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>配置你的GitHub(包括SSH和GPG) | Share Some Tech</title>
<meta name=keywords content="github,gnupg,ssh"><meta name=description content="由于有时候会在不同的主机上修改我的一些 GitHub 仓库代码，这些代码大多是一些配置文件，比如各种 dotfile，每次增加一台新机器就需要重新设置一遍，因此在此记录一下配置步骤，后续考虑尽可能集成到一个脚本中。以下内容并不适用 Windows 系统。
SSH 相关配置 首先来配置 ssh，虽然这不是唯一的推送方式，但是在一台较为常用且安全性得到保障（没有暴露在公网）的机器上，我认为还是 SSH 配置更好一些，可以免去每次粘贴一大段 token 的必要，接下来的部分主要都参考自 GitHub 的官方文档。
生成 SSH 密钥 这里用到的命令是ssh-keygen，如果你的系统没有这个命令，那么访问这里来查看并安装对应的包。你可以通过man ssh-keygen查看该命令的详细手册，在其诸多选项中，此处只会用到 -t 选项，这决定了生成密钥使用的算法。 打开终端，在命令行输入ssh-keygen -t ed25519，然后会得到类似这样的输出：
Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): 这是在让我们选择密钥的保存位置，如果这是第一次生成，那么直接回车即可，接着会出现以下内容：
Enter passphrase (empty for no passphrase): 这是让我们为此密钥设置一个密码，设置完成之后按回车，或者直接按回车代表不设置密码，然后重复密码并回车，一个密钥就生成了。这个命令的整体输出类似这样：
➜ ~ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/."><meta name=author content="eyebrowkang"><link rel=canonical href=https://tech.eyebrowkang.com/posts/2023-06-03-%e9%85%8d%e7%bd%ae%e4%bd%a0%e7%9a%84GitHub%28%e5%8c%85%e6%8b%acSSH%e5%92%8cGPG%29/><link crossorigin=anonymous href=/assets/css/stylesheet.1b82bbed8b13f853704558d527b681efaea938ce91e6ae8903e8b19e73b1b0f8.css integrity="sha256-G4K77YsT+FNwRVjVJ7aB766pOM6R5q6JA+ixnnOxsPg=" rel="preload stylesheet" as=style><link rel=icon href=https://static.eyebrowkang.com/eyebrow.png><link rel=icon type=image/png sizes=16x16 href=https://tech.eyebrowkang.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tech.eyebrowkang.com/favicon-32x32.png><link rel=apple-touch-icon href=https://static.eyebrowkang.com/eyebrow.png><link rel=mask-icon href=https://static.eyebrowkang.com/eyebrow.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="配置你的GitHub(包括SSH和GPG)"><meta property="og:description" content="由于有时候会在不同的主机上修改我的一些 GitHub 仓库代码，这些代码大多是一些配置文件，比如各种 dotfile，每次增加一台新机器就需要重新设置一遍，因此在此记录一下配置步骤，后续考虑尽可能集成到一个脚本中。以下内容并不适用 Windows 系统。
SSH 相关配置 首先来配置 ssh，虽然这不是唯一的推送方式，但是在一台较为常用且安全性得到保障（没有暴露在公网）的机器上，我认为还是 SSH 配置更好一些，可以免去每次粘贴一大段 token 的必要，接下来的部分主要都参考自 GitHub 的官方文档。
生成 SSH 密钥 这里用到的命令是ssh-keygen，如果你的系统没有这个命令，那么访问这里来查看并安装对应的包。你可以通过man ssh-keygen查看该命令的详细手册，在其诸多选项中，此处只会用到 -t 选项，这决定了生成密钥使用的算法。 打开终端，在命令行输入ssh-keygen -t ed25519，然后会得到类似这样的输出：
Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): 这是在让我们选择密钥的保存位置，如果这是第一次生成，那么直接回车即可，接着会出现以下内容：
Enter passphrase (empty for no passphrase): 这是让我们为此密钥设置一个密码，设置完成之后按回车，或者直接按回车代表不设置密码，然后重复密码并回车，一个密钥就生成了。这个命令的整体输出类似这样：
➜ ~ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/."><meta property="og:type" content="article"><meta property="og:url" content="https://tech.eyebrowkang.com/posts/2023-06-03-%E9%85%8D%E7%BD%AE%E4%BD%A0%E7%9A%84github%E5%8C%85%E6%8B%ACssh%E5%92%8Cgpg/"><meta property="og:image" content="https://tech.eyebrowkang.com/blog-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-03T18:27:50+08:00"><meta property="article:modified_time" content="2023-06-03T18:27:50+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tech.eyebrowkang.com/blog-cover.png"><meta name=twitter:title content="配置你的GitHub(包括SSH和GPG)"><meta name=twitter:description content="由于有时候会在不同的主机上修改我的一些 GitHub 仓库代码，这些代码大多是一些配置文件，比如各种 dotfile，每次增加一台新机器就需要重新设置一遍，因此在此记录一下配置步骤，后续考虑尽可能集成到一个脚本中。以下内容并不适用 Windows 系统。
SSH 相关配置 首先来配置 ssh，虽然这不是唯一的推送方式，但是在一台较为常用且安全性得到保障（没有暴露在公网）的机器上，我认为还是 SSH 配置更好一些，可以免去每次粘贴一大段 token 的必要，接下来的部分主要都参考自 GitHub 的官方文档。
生成 SSH 密钥 这里用到的命令是ssh-keygen，如果你的系统没有这个命令，那么访问这里来查看并安装对应的包。你可以通过man ssh-keygen查看该命令的详细手册，在其诸多选项中，此处只会用到 -t 选项，这决定了生成密钥使用的算法。 打开终端，在命令行输入ssh-keygen -t ed25519，然后会得到类似这样的输出：
Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): 这是在让我们选择密钥的保存位置，如果这是第一次生成，那么直接回车即可，接着会出现以下内容：
Enter passphrase (empty for no passphrase): 这是让我们为此密钥设置一个密码，设置完成之后按回车，或者直接按回车代表不设置密码，然后重复密码并回车，一个密钥就生成了。这个命令的整体输出类似这样：
➜ ~ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://tech.eyebrowkang.com/posts/"},{"@type":"ListItem","position":3,"name":"配置你的GitHub(包括SSH和GPG)","item":"https://tech.eyebrowkang.com/posts/2023-06-03-%E9%85%8D%E7%BD%AE%E4%BD%A0%E7%9A%84github%E5%8C%85%E6%8B%ACssh%E5%92%8Cgpg/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"配置你的GitHub(包括SSH和GPG)","name":"配置你的GitHub(包括SSH和GPG)","description":"由于有时候会在不同的主机上修改我的一些 GitHub 仓库代码，这些代码大多是一些配置文件，比如各种 dotfile，每次增加一台新机器就需要重新设置一遍，因此在此记录一下配置步骤，后续考虑尽可能集成到一个脚本中。以下内容并不适用 Windows 系统。\nSSH 相关配置 首先来配置 ssh，虽然这不是唯一的推送方式，但是在一台较为常用且安全性得到保障（没有暴露在公网）的机器上，我认为还是 SSH 配置更好一些，可以免去每次粘贴一大段 token 的必要，接下来的部分主要都参考自 GitHub 的官方文档。\n生成 SSH 密钥 这里用到的命令是ssh-keygen，如果你的系统没有这个命令，那么访问这里来查看并安装对应的包。你可以通过man ssh-keygen查看该命令的详细手册，在其诸多选项中，此处只会用到 -t 选项，这决定了生成密钥使用的算法。 打开终端，在命令行输入ssh-keygen -t ed25519，然后会得到类似这样的输出：\nGenerating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): 这是在让我们选择密钥的保存位置，如果这是第一次生成，那么直接回车即可，接着会出现以下内容：\nEnter passphrase (empty for no passphrase): 这是让我们为此密钥设置一个密码，设置完成之后按回车，或者直接按回车代表不设置密码，然后重复密码并回车，一个密钥就生成了。这个命令的整体输出类似这样：\n➜ ~ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.","keywords":["github","gnupg","ssh"],"articleBody":"由于有时候会在不同的主机上修改我的一些 GitHub 仓库代码，这些代码大多是一些配置文件，比如各种 dotfile，每次增加一台新机器就需要重新设置一遍，因此在此记录一下配置步骤，后续考虑尽可能集成到一个脚本中。以下内容并不适用 Windows 系统。\nSSH 相关配置 首先来配置 ssh，虽然这不是唯一的推送方式，但是在一台较为常用且安全性得到保障（没有暴露在公网）的机器上，我认为还是 SSH 配置更好一些，可以免去每次粘贴一大段 token 的必要，接下来的部分主要都参考自 GitHub 的官方文档。\n生成 SSH 密钥 这里用到的命令是ssh-keygen，如果你的系统没有这个命令，那么访问这里来查看并安装对应的包。你可以通过man ssh-keygen查看该命令的详细手册，在其诸多选项中，此处只会用到 -t 选项，这决定了生成密钥使用的算法。 打开终端，在命令行输入ssh-keygen -t ed25519，然后会得到类似这样的输出：\nGenerating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): 这是在让我们选择密钥的保存位置，如果这是第一次生成，那么直接回车即可，接着会出现以下内容：\nEnter passphrase (empty for no passphrase): 这是让我们为此密钥设置一个密码，设置完成之后按回车，或者直接按回车代表不设置密码，然后重复密码并回车，一个密钥就生成了。这个命令的整体输出类似这样：\n➜ ~ ssh-keygen -t ed25519 Generating public/private ed25519 key pair. Enter file in which to save the key (/root/.ssh/id_ed25519): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_ed25519 Your public key has been saved in /root/.ssh/id_ed25519.pub The key fingerprint is: SHA256:9T+8qnJrytq3BntQ/Ad9ufyGimAuYNUqux3SceXkP3Q root@VM-16-7-debian The key's randomart image is: +--[ED25519 256]--+ | | | | | . .+ . .| | . .*o.. ...| | ...S.o.o.E..| | +..oo o.+.o | | ..+o o+ o.+..| | .o.*o.*. ..oo| | ..oo=O=+oo.. | +----[SHA256]-----+ 在这次操作中，我们得到了两个文件，id_ed25519.pub是公钥，id_ed25519是私钥，其中公钥会上传到 GitHub 上，私钥则保存在本地，且要注意谨防泄露。\n添加 SSH 公钥至 GitHub 登录 GitHub 之后访问Add new SSH keys页面，会看到一个表单，我们只需要设置 Title 和 Key 两个字段的值即可，Title 可以随意填写，建议填写当前机器的主机名。然后我们先返回到终端，根据前面命令的输出结果找到公钥的完整路径，通过cat命令将公钥打印在终端中，对于我上面的输出结果而言，我应该执行cat /root/.ssh/id_ed25519.pub命令，其完整内容类似这样：\n➜ ~ cat /root/.ssh/id_ed25519.pub ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH6/vsvmVi2MHq7duEZJ+Fv6FAZGG6dTZkPQWXKcRwId root@VM-16-7-debian 将该命令的输出结果复制并粘贴至 GitHub 页面的 Key 字段处，然后点击Add SSH Key按钮确认，页面会提示添加成功。\nSSH 配置文件 接下来，我们要在本地配置私钥，以便在连接 GitHub 时能够完成认证。进入家目录下的.ssh文件夹，此时该目录下应该只有两个文件，即前面生成的公钥和私钥，我们创建一个config文件，然后将下面这段内容粘贴到config文件中：\nHost github.com Hostname ssh.github.com User eyebrowkang Port 443 PreferredAuthentications publickey IdentityFile ~/.ssh/id_ed25519 你需要修改 User 之后的用户名为自己的用户名，然后保存并退出。 这是 ssh 的配置文件，可以通过man ssh_config命令查看具体的手册内容，其中详细解释了每个字段是什么意思，以及可以填哪些值，在此不做赘述。\n验证 SSH 是否绑定成功 理论上来说，已经能够成功地通过 SSH 访问 GitHub 了，我们可以通过ssh -T git@github.com来验证，首次输入会得到这样的一个输出：\n➜ ~ ssh -T git@github.com The authenticity of host '[ssh.github.com]:443 ([20.205.243.160]:443)' can't be established. ED25519 key fingerprint is SHA256:+DiF5lqwHfHwaSabpZisF/zLDA0zPMSvHdkr4UvCOqU. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? 输入yes并回车，然后你应该得到这样的输出结果：\nWarning: Permanently added '[ssh.github.com]:443' (ED25519) to the list of known hosts. Hi eyebrowkang! You've successfully authenticated, but GitHub does not provide shell access. 这就代表设置成功了。\nSSH 密钥对的其他用处 前面生成的密钥对，除了可以用于 GitHub 还可以用于 SSH 连接服务器或者其他的 git 服务，比如 GitLab 等，你不必为每一个 SSH 服务都生成一个密钥对，当然你也可以生成，这全凭个人喜好。需要注意的是，任何时候，你都不需要将私钥上传到这些服务平台上，甚至于你完全不需要知道私钥文件的内容是什么。如果这对密钥绑定了很多的平台，比如各种 git 服务，各种云服务器，那么你一定需要备份它们，可以直接将文件复制到 U 盘中，最好不要放在各类云盘中。下面要讲到的 GPG key 的备份也是同样的道理。\nGPG Key 相关配置 GPG Key 有两个作用：加密和签名，在 GitHub 中我们只需要其签名的功能即可。具体体现在 GitHub 网站的 commit 记录上会有一个Verfied的绿色标志，这在多人协作的开源项目中比较重要，可以避免他人伪造成员的姓名和邮箱来提交，个人的项目实际上是无所谓的。 如果没有 gpg 命令，那么访问这里来安装对应的包。同样的，这是 GitHub 官方配置文档，下述内容大多参考自此文档。\n生成 GPG Key 打开终端，输入gpg --full-generate-key命令，会得到一份类似这样的输出：\ngpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. gpg: directory '/root/.gnupg' created gpg: keybox '/root/.gnupg/pubring.kbx' created Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 如果你计划这个密钥只用于签名并不用于加密数据，那么建议输入 4，否则建议保持默认，直接回车，接着需要选择密钥长度：\nRSA keys may be between 1024 and 4096 bits long. What keysize do you want? (3072) 这里根据个人喜好输入即可，我倾向于直接输入 4096，然后需要设置过期时间：\nRequested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire = key expires in n days w = key expires in n weeks m = key expires in n months y = key expires in n years Key is valid for? (0) 我直接输入 0，代表永远不过期，并回车。然后再次确认：\nKey does not expire at all Is this correct? (y/N) 输入 y 并回车，接着需要填写真实名字，邮箱地址，和评论三个字段，虽然实际上这里是可以随意填写的，但是由于目的是配置 GitHub，因此建议Real name填写 GitHub 的用户名，Email address使用 GitHub 的noreply 邮箱，评论随意，类似如下的效果：\nGnuPG needs to construct a user ID to identify your key. Real name: eyebrowkang Email address: 48169104+eyebrowkang@users.noreply.github.com Comment: 除此之外，还需要设置密码，此处的密码建议输入，后续导出和销毁都要用，然后输出如下：\nYou selected this USER-ID: \"eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e\" Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? 输入O确认，接着会得到一段这样的文字：\nWe need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. 其目的是更好地生成一些随机的字节，这个时间应该很短，可以晃晃鼠标，按两下键盘，或者什么都不做也可以，然后就会得到这样的输出：\ngpg: /root/.gnupg/trustdb.gpg: trustdb created gpg: key DCA603FF70CDCDD0 marked as ultimately trusted gpg: directory '/root/.gnupg/openpgp-revocs.d' created gpg: revocation certificate stored as '/root/.gnupg/openpgp-revocs.d/B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0.rev' public and secret key created and signed. pub rsa4096 2023-06-03 [SC] B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0 uid eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e sub rsa4096 2023-06-03 [E] 这就代表成功了。\n添加至 GitHub 首先需要获取密钥的 ID，输入gpg --list-secret-keys --keyid-format LONG，得到如下输出：\ngpg: checking the trustdb gpg: marginals needed: 3 completes needed: 1 trust model: pgp gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u /root/.gnupg/pubring.kbx ------------------------ sec rsa4096/DCA603FF70CDCDD0 2023-06-03 [SC] B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0 uid [ultimate] eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e ssb rsa4096/57D615B2EC5D45C1 2023-06-03 [E] 其中 sec 字段代表这是主密钥，ssb 代表这是子密钥。此处我们需要使用主密钥，输入gpg --armor --export DCA603FF70CDCDD0命令，会得到一长串的输出，这是主密钥的公钥部分，如下所示(有截断)：\n-----BEGIN PGP PUBLIC KEY BLOCK----- mQINBGR6/6IBEADatsJbClB2bzL/egH3MBnFHriC1Pht2oextY5ccRnt2ILoQ03w ... ... ... EpY+XBZcPygWCl4gU2BS/PuDUYidFDo= =N2E3 -----END PGP PUBLIC KEY BLOCK----- 将这部分内容完整的复制下来，然后访问GPG Key 的添加页面，粘贴到 Key 字段输入框中，Title 字段随意输入，和 SSH Key 一样，建议为当前主机名，然后确认，提示成功添加即可。\n设置 git 提交签名 GPG Key 的作用是体现在 git commit 时的，也就是即便是一个本地的 git 仓库，也可以使用 GPG Key 签名，这里我们可以选择使用子密钥或者主密钥来完成签名，建议使用子密钥，因为主密钥可以撤销子密钥，也可以生成多个子密钥。输入git config --global user.signingkey 57D615B2EC5D45C1命令，在全局配置 commit 时签名使用的 key id，此处使用的便是 ssb 一行的子密钥。然后输入git config --global commit.gpgsign true，设置所有的 git 提交都需要签名。或者上述两个 git 命令都可以通过去掉--global字段，在当前所在的 git 仓库目录运行，这将仅作用于当前所在的 git 仓库。 接着在.bashrc其他 shell 配置文件中添加如下环境变量：\nexport GPG_TTY=$(tty) 重新进入终端并输入killall gpg-agent杀掉 gpg 进程，然后可以随便提交一次，能够成功提交就代表设置成功了。也可以通过git log --show-signature命令查看详细的信息。 至此就配置成功了，当 push 到 GitHub 之后，就可以看到认证了。不过除此之外，关于 GPG 的使用还有一些内容要注意的。\n备份和主密钥的撤销 你可以在不同的设备上使用同一份 GPG Key，你可以使用同一个子密钥，也可以生成多个子密钥供不同设备使用。一般来说我们只需要导出主密钥的公钥和私钥即可。输入gpg --armor --export DCA603FF70CDCDD0 \u003e public-key.asc命令导出主密钥公钥，输入gpg --armor --export-secret-keys DCA603FF70CDCDD0 \u003e private-key.asc命令导出主密钥私钥。这将会得到两个文件，这两个文件需要妥善保存，并且可以通过如下的命令在另一台设备导入：\ngpg --import public-key.asc gpg --import private-key.asc 除此之外，最好生成并备份撤销证书，这可以在密钥泄露之后对 GPG Key 进行撤销操作，撤销之后的密钥对就相当于作废了。输入gpg --output revoke.asc --gen-revoke DCA603FF70CDCDD0命令得到revoke.asc文件，即为撤销证书。撤销的命令是gpg --import revoke.asc，注意该操作不可逆，谨慎操作。 另外，撤销和删除是不同的操作，这个命令gpg --delete-keys DCA603FF70CDCDD0会删除主密钥，一般来说只有撤销或者设置密钥不被信任之后才可以删除，否则 gpg 会阻止删除操作。\n子密钥的生成和撤销 输入gpg --edit-key DCA603FF70CDCDD0命令，进入一个交互模式，效果如下：\n➜ ~ gpg --edit-key DCA603FF70CDCDD0 gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Secret key is available. sec rsa4096/DCA603FF70CDCDD0 created: 2023-06-03 expires: never usage: SC trust: ultimate validity: ultimate ssb rsa4096/57D615B2EC5D45C1 created: 2023-06-03 expires: never usage: E [ultimate] (1). eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e gpg\u003e 你可以输入 help 查看所有命令，这里我们输入addkey会输出创建主密钥时类似的提示，选择算法：\ngpg\u003e addkey Please select what kind of key you want: (3) DSA (sign only) (4) RSA (sign only) (5) Elgamal (encrypt only) (6) RSA (encrypt only) (14) Existing key from card Your selection? 这里就选一个 4 好了，只用于签名，之后的各种提示和前面一样，不做赘述，最终输出如下：\nsec rsa4096/DCA603FF70CDCDD0 created: 2023-06-03 expires: never usage: SC trust: ultimate validity: ultimate ssb rsa4096/57D615B2EC5D45C1 created: 2023-06-03 expires: never usage: E ssb rsa4096/6D27CF5A5037DE52 created: 2023-06-03 expires: never usage: S [ultimate] (1). eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e 会发现，多了一个密钥，其中 usage 的值为 S，代表 sign，这就是刚刚生成的子密钥，然后输入save保存并退出，就可以使用了。 如果想要撤销一个子密钥，先进入交互模式gpg --edit-key DCA603FF70CDCDD0，比如我想撤销第二个子密钥，那就输入key 2，会输出：\ngpg\u003e key 2 sec rsa4096/DCA603FF70CDCDD0 created: 2023-06-03 expires: never usage: SC trust: ultimate validity: ultimate ssb rsa4096/57D615B2EC5D45C1 created: 2023-06-03 expires: never usage: E ssb* rsa4096/6D27CF5A5037DE52 created: 2023-06-03 expires: never usage: S [ultimate] (1). eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e 这里第二个 ssb 后面多个一个星号，代表它被选中了，然后输入revkey回车，经过一系列交互之后得到如下的输出结果：\ngpg\u003e revkey Do you really want to revoke this subkey? (y/N) y Please select the reason for the revocation: 0 = No reason specified 1 = Key has been compromised 2 = Key is superseded 3 = Key is no longer used Q = Cancel Your decision? 0 Enter an optional description; end it with an empty line: \u003e Reason for revocation: No reason specified (No description given) Is this okay? (y/N) y sec rsa4096/DCA603FF70CDCDD0 created: 2023-06-03 expires: never usage: SC trust: ultimate validity: ultimate ssb rsa4096/57D615B2EC5D45C1 created: 2023-06-03 expires: never usage: E The following key was revoked on 2023-06-03 by RSA key DCA603FF70CDCDD0 eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e ssb rsa4096/6D27CF5A5037DE52 created: 2023-06-03 revoked: 2023-06-03 usage: S [ultimate] (1). eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e 然后输入save回车，就成功撤销了这个子密钥。再次查询列表时会发现该子密钥已经不存在：\n➜ ~ gpg --list-secret-keys --keyid-format LONG /root/.gnupg/pubring.kbx ------------------------ sec rsa4096/DCA603FF70CDCDD0 2023-06-03 [SC] B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0 uid [ultimate] eyebrowkang \u003c48169104+eyebrowkang@users.noreply.github.com\u003e ssb rsa4096/57D615B2EC5D45C1 2023-06-03 [E] 不过这并没有删除子密钥，如果要删除的话，可以再次进入交互模式并选中对应的子密钥，然后通过delkey命令来删除。\n其他配置 如果是 MacOS，并且想要让设备记住 gpg 密码，那么需要安装pinentry-mac这个包，然后运行echo \"pinentry-program $(which pinentry-mac)\" \u003e\u003e ~/.gnupg/gpg-agent.conf命令，并重启 gpg-agent。\n如果仅需要在 git 的 submodule 中设置签名，那么就先进入该 submodule，然后运行git config user.signingkey 57D615B2EC5D45C1即可。\n常用命令汇总 gpg --full-generate-key gpg --list-keys gpg --list-secret-keys --keyid-format LONG gpg --armor --export gpg --output revoke.asc --gen-revoke gpg --edit-key gpg --armor --export \u003e public-key.asc gpg --armor --export-secret-keys \u003e private-key.asc gpg --import public-key.asc gpg --import private-key.asc gpg --delete-keys gpg --delete-secret-keys git config user.signingkey git config commit.gpgsign true ","wordCount":"1167","inLanguage":"zh","datePublished":"2023-06-03T18:27:50+08:00","dateModified":"2023-06-03T18:27:50+08:00","author":{"@type":"Person","name":"eyebrowkang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.eyebrowkang.com/posts/2023-06-03-%E9%85%8D%E7%BD%AE%E4%BD%A0%E7%9A%84github%E5%8C%85%E6%8B%ACssh%E5%92%8Cgpg/"},"publisher":{"@type":"Organization","name":"Share Some Tech","logo":{"@type":"ImageObject","url":"https://static.eyebrowkang.com/eyebrow.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tech.eyebrowkang.com accesskey=h title="Share Some Tech (Alt + H)">Share Some Tech</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tech.eyebrowkang.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://tech.eyebrowkang.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://tech.eyebrowkang.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tech.eyebrowkang.com>主页</a>&nbsp;»&nbsp;<a href=https://tech.eyebrowkang.com/posts/>Posts</a></div><h1 class=post-title>配置你的GitHub(包括SSH和GPG)</h1><div class=post-meta><span title='2023-06-03 18:27:50 +0800 CST'>六月 3, 2023</span>&nbsp;·&nbsp;eyebrowkang&nbsp;|&nbsp;<a href=https://github.com/eyebrowkang/eyebrowkang.github.io/issues rel="noopener noreferrer" target=_blank>Have issues</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ssh-相关配置>SSH 相关配置</a><ul><li><a href=#生成-ssh-密钥>生成 SSH 密钥</a></li><li><a href=#添加-ssh-公钥至-github>添加 SSH 公钥至 GitHub</a></li><li><a href=#ssh-配置文件>SSH 配置文件</a></li><li><a href=#验证-ssh-是否绑定成功>验证 SSH 是否绑定成功</a></li><li><a href=#ssh-密钥对的其他用处>SSH 密钥对的其他用处</a></li></ul></li><li><a href=#gpg-key-相关配置>GPG Key 相关配置</a><ul><li><a href=#生成-gpg-key>生成 GPG Key</a></li><li><a href=#添加至-github>添加至 GitHub</a></li><li><a href=#设置-git-提交签名>设置 git 提交签名</a></li><li><a href=#备份和主密钥的撤销>备份和主密钥的撤销</a></li><li><a href=#子密钥的生成和撤销>子密钥的生成和撤销</a></li><li><a href=#其他配置>其他配置</a></li><li><a href=#常用命令汇总>常用命令汇总</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>由于有时候会在不同的主机上修改我的一些 GitHub 仓库代码，这些代码大多是一些配置文件，比如各种 dotfile，每次增加一台新机器就需要重新设置一遍，因此在此记录一下配置步骤，后续考虑尽可能集成到一个脚本中。以下内容并不适用 Windows 系统。</p><h2 id=ssh-相关配置>SSH 相关配置<a hidden class=anchor aria-hidden=true href=#ssh-相关配置>#</a></h2><p>首先来配置 ssh，虽然这不是唯一的推送方式，但是在一台较为常用且安全性得到保障（没有暴露在公网）的机器上，我认为还是 SSH 配置更好一些，可以免去每次粘贴一大段 token 的必要，接下来的部分主要都参考自 GitHub 的<a href=https://docs.github.com/zh/authentication/connecting-to-github-with-ssh>官方文档</a>。</p><h3 id=生成-ssh-密钥>生成 SSH 密钥<a hidden class=anchor aria-hidden=true href=#生成-ssh-密钥>#</a></h3><p>这里用到的命令是<code>ssh-keygen</code>，如果你的系统没有这个命令，那么访问<a href=https://command-not-found.com/ssh-keygen>这里</a>来查看并安装对应的包。你可以通过<code>man ssh-keygen</code>查看该命令的详细手册，在其诸多选项中，此处只会用到 <code>-t</code> 选项，这决定了生成密钥使用的算法。
打开终端，在命令行输入<code>ssh-keygen -t ed25519</code>，然后会得到类似这样的输出：</p><pre tabindex=0><code>Generating public/private ed25519 key pair.
Enter file in which to save the key (/root/.ssh/id_ed25519):
</code></pre><p>这是在让我们选择密钥的保存位置，如果这是第一次生成，那么直接回车即可，接着会出现以下内容：</p><pre tabindex=0><code>Enter passphrase (empty for no passphrase):
</code></pre><p>这是让我们为此密钥设置一个密码，设置完成之后按回车，或者直接按回车代表不设置密码，然后重复密码并回车，一个密钥就生成了。这个命令的整体输出类似这样：</p><pre tabindex=0><code>➜  ~ ssh-keygen -t ed25519
Generating public/private ed25519 key pair.
Enter file in which to save the key (/root/.ssh/id_ed25519):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_ed25519
Your public key has been saved in /root/.ssh/id_ed25519.pub
The key fingerprint is:
SHA256:9T+8qnJrytq3BntQ/Ad9ufyGimAuYNUqux3SceXkP3Q root@VM-16-7-debian
The key&#39;s randomart image is:
+--[ED25519 256]--+
|                 |
|                 |
|       . .+  .  .|
|      . .*o.. ...|
|     ...S.o.o.E..|
|    +..oo  o.+.o |
|   ..+o o+  o.+..|
|    .o.*o.*. ..oo|
|    ..oo=O=+oo.. |
+----[SHA256]-----+
</code></pre><p>在这次操作中，我们得到了两个文件，<code>id_ed25519.pub</code>是公钥，<code>id_ed25519</code>是私钥，其中公钥会上传到 GitHub 上，私钥则保存在本地，且要注意谨防泄露。</p><h3 id=添加-ssh-公钥至-github>添加 SSH 公钥至 GitHub<a hidden class=anchor aria-hidden=true href=#添加-ssh-公钥至-github>#</a></h3><p>登录 GitHub 之后访问<a href=https://github.com/settings/ssh/new>Add new SSH keys</a>页面，会看到一个表单，我们只需要设置 Title 和 Key 两个字段的值即可，Title 可以随意填写，建议填写当前机器的主机名。然后我们先返回到终端，根据前面命令的输出结果找到公钥的完整路径，通过<code>cat</code>命令将公钥打印在终端中，对于我上面的输出结果而言，我应该执行<code>cat /root/.ssh/id_ed25519.pub</code>命令，其完整内容类似这样：</p><pre tabindex=0><code>➜  ~ cat /root/.ssh/id_ed25519.pub
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH6/vsvmVi2MHq7duEZJ+Fv6FAZGG6dTZkPQWXKcRwId root@VM-16-7-debian
</code></pre><p>将该命令的输出结果复制并粘贴至 GitHub 页面的 Key 字段处，然后点击<code>Add SSH Key</code>按钮确认，页面会提示添加成功。</p><h3 id=ssh-配置文件>SSH 配置文件<a hidden class=anchor aria-hidden=true href=#ssh-配置文件>#</a></h3><p>接下来，我们要在本地配置私钥，以便在连接 GitHub 时能够完成认证。进入家目录下的<code>.ssh</code>文件夹，此时该目录下应该只有两个文件，即前面生成的公钥和私钥，我们创建一个<code>config</code>文件，然后将下面这段内容粘贴到<code>config</code>文件中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Host github.com
</span></span><span class=line><span class=cl>  Hostname ssh.github.com
</span></span><span class=line><span class=cl>  User eyebrowkang
</span></span><span class=line><span class=cl>  Port <span class=m>443</span>
</span></span><span class=line><span class=cl>  PreferredAuthentications publickey
</span></span><span class=line><span class=cl>  IdentityFile ~/.ssh/id_ed25519
</span></span></code></pre></div><p>你需要修改 User 之后的用户名为自己的用户名，然后保存并退出。
这是 ssh 的配置文件，可以通过<code>man ssh_config</code>命令查看具体的手册内容，其中详细解释了每个字段是什么意思，以及可以填哪些值，在此不做赘述。</p><h3 id=验证-ssh-是否绑定成功>验证 SSH 是否绑定成功<a hidden class=anchor aria-hidden=true href=#验证-ssh-是否绑定成功>#</a></h3><p>理论上来说，已经能够成功地通过 SSH 访问 GitHub 了，我们可以通过<code>ssh -T git@github.com</code>来验证，首次输入会得到这样的一个输出：</p><pre tabindex=0><code>➜  ~ ssh -T git@github.com
The authenticity of host &#39;[ssh.github.com]:443 ([20.205.243.160]:443)&#39; can&#39;t be established.
ED25519 key fingerprint is SHA256:+DiF5lqwHfHwaSabpZisF/zLDA0zPMSvHdkr4UvCOqU.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</code></pre><p>输入<code>yes</code>并回车，然后你应该得到这样的输出结果：</p><pre tabindex=0><code>Warning: Permanently added &#39;[ssh.github.com]:443&#39; (ED25519) to the list of known hosts.
Hi eyebrowkang! You&#39;ve successfully authenticated, but GitHub does not provide shell access.
</code></pre><p>这就代表设置成功了。</p><h3 id=ssh-密钥对的其他用处>SSH 密钥对的其他用处<a hidden class=anchor aria-hidden=true href=#ssh-密钥对的其他用处>#</a></h3><p>前面生成的密钥对，除了可以用于 GitHub 还可以用于 SSH 连接服务器或者其他的 git 服务，比如 GitLab 等，你不必为每一个 SSH 服务都生成一个密钥对，当然你也可以生成，这全凭个人喜好。需要注意的是，任何时候，你都不需要将私钥上传到这些服务平台上，甚至于你完全不需要知道私钥文件的内容是什么。如果这对密钥绑定了很多的平台，比如各种 git 服务，各种云服务器，那么你一定需要备份它们，可以直接将文件复制到 U 盘中，最好不要放在各类云盘中。下面要讲到的 GPG key 的备份也是同样的道理。</p><h2 id=gpg-key-相关配置>GPG Key 相关配置<a hidden class=anchor aria-hidden=true href=#gpg-key-相关配置>#</a></h2><p>GPG Key 有两个作用：加密和签名，在 GitHub 中我们只需要其签名的功能即可。具体体现在 GitHub 网站的 commit 记录上会有一个<code>Verfied</code>的绿色标志，这在多人协作的开源项目中比较重要，可以避免他人伪造成员的姓名和邮箱来提交，个人的项目实际上是无所谓的。
如果没有 gpg 命令，那么访问<a href=https://command-not-found.com/gpg>这里</a>来安装对应的包。同样的，这是 GitHub 官方<a href=https://docs.github.com/zh/authentication/managing-commit-signature-verification>配置文档</a>，下述内容大多参考自此文档。</p><h3 id=生成-gpg-key>生成 GPG Key<a hidden class=anchor aria-hidden=true href=#生成-gpg-key>#</a></h3><p>打开终端，输入<code>gpg --full-generate-key</code>命令，会得到一份类似这样的输出：</p><pre tabindex=0><code>gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

gpg: directory &#39;/root/.gnupg&#39; created
gpg: keybox &#39;/root/.gnupg/pubring.kbx&#39; created
Please select what kind of key you want:
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
  (14) Existing key from card
Your selection?
</code></pre><p>如果你计划这个密钥只用于签名并不用于加密数据，那么建议输入 4，否则建议保持默认，直接回车，接着需要选择密钥长度：</p><pre tabindex=0><code>RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (3072)
</code></pre><p>这里根据个人喜好输入即可，我倾向于直接输入 4096，然后需要设置过期时间：</p><pre tabindex=0><code>Requested keysize is 4096 bits
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0)
</code></pre><p>我直接输入 0，代表永远不过期，并回车。然后再次确认：</p><pre tabindex=0><code>Key does not expire at all
Is this correct? (y/N)
</code></pre><p>输入 y 并回车，接着需要填写真实名字，邮箱地址，和评论三个字段，虽然实际上这里是可以随意填写的，但是由于目的是配置 GitHub，因此建议<code>Real name</code>填写 GitHub 的用户名，<code>Email address</code>使用 GitHub 的<a href=https://docs.github.com/zh/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address>noreply 邮箱</a>，评论随意，类似如下的效果：</p><pre tabindex=0><code>
GnuPG needs to construct a user ID to identify your key.

Real name: eyebrowkang
Email address: 48169104+eyebrowkang@users.noreply.github.com
Comment:
</code></pre><p>除此之外，还需要设置密码，此处的密码建议输入，后续导出和销毁都要用，然后输出如下：</p><pre tabindex=0><code>You selected this USER-ID:
    &#34;eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;&#34;

Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit?
</code></pre><p>输入<code>O</code>确认，接着会得到一段这样的文字：</p><pre tabindex=0><code>We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
</code></pre><p>其目的是更好地生成一些随机的字节，这个时间应该很短，可以晃晃鼠标，按两下键盘，或者什么都不做也可以，然后就会得到这样的输出：</p><pre tabindex=0><code>gpg: /root/.gnupg/trustdb.gpg: trustdb created
gpg: key DCA603FF70CDCDD0 marked as ultimately trusted
gpg: directory &#39;/root/.gnupg/openpgp-revocs.d&#39; created
gpg: revocation certificate stored as &#39;/root/.gnupg/openpgp-revocs.d/B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0.rev&#39;
public and secret key created and signed.

pub   rsa4096 2023-06-03 [SC]
      B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0
uid                      eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;
sub   rsa4096 2023-06-03 [E]
</code></pre><p>这就代表成功了。</p><h3 id=添加至-github>添加至 GitHub<a hidden class=anchor aria-hidden=true href=#添加至-github>#</a></h3><p>首先需要获取密钥的 ID，输入<code>gpg --list-secret-keys --keyid-format LONG</code>，得到如下输出：</p><pre tabindex=0><code>gpg: checking the trustdb
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
/root/.gnupg/pubring.kbx
------------------------
sec   rsa4096/DCA603FF70CDCDD0 2023-06-03 [SC]
      B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0
uid                 [ultimate] eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;
ssb   rsa4096/57D615B2EC5D45C1 2023-06-03 [E]
</code></pre><p>其中 sec 字段代表这是主密钥，ssb 代表这是子密钥。此处我们需要使用主密钥，输入<code>gpg --armor --export DCA603FF70CDCDD0</code>命令，会得到一长串的输出，这是主密钥的公钥部分，如下所示(有截断)：</p><pre tabindex=0><code>-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGR6/6IBEADatsJbClB2bzL/egH3MBnFHriC1Pht2oextY5ccRnt2ILoQ03w
... ... ...
EpY+XBZcPygWCl4gU2BS/PuDUYidFDo=
=N2E3
-----END PGP PUBLIC KEY BLOCK-----
</code></pre><p>将这部分内容完整的复制下来，然后访问<a href=https://github.com/settings/gpg/new>GPG Key 的添加页面</a>，粘贴到 Key 字段输入框中，Title 字段随意输入，和 SSH Key 一样，建议为当前主机名，然后确认，提示成功添加即可。</p><h3 id=设置-git-提交签名>设置 git 提交签名<a hidden class=anchor aria-hidden=true href=#设置-git-提交签名>#</a></h3><p>GPG Key 的作用是体现在 git commit 时的，也就是即便是一个本地的 git 仓库，也可以使用 GPG Key 签名，这里我们可以选择使用子密钥或者主密钥来完成签名，建议使用子密钥，因为主密钥可以撤销子密钥，也可以生成多个子密钥。输入<code>git config --global user.signingkey 57D615B2EC5D45C1</code>命令，在全局配置 commit 时签名使用的 key id，此处使用的便是 ssb 一行的子密钥。然后输入<code>git config --global commit.gpgsign true</code>，设置所有的 git 提交都需要签名。或者上述两个 git 命令都可以通过去掉<code>--global</code>字段，在当前所在的 git 仓库目录运行，这将仅作用于当前所在的 git 仓库。
接着在<code>.bashrc</code>其他 shell 配置文件中添加如下环境变量：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GPG_TTY</span><span class=o>=</span><span class=k>$(</span>tty<span class=k>)</span>
</span></span></code></pre></div><p>重新进入终端并输入<code>killall gpg-agent</code>杀掉 gpg 进程，然后可以随便提交一次，能够成功提交就代表设置成功了。也可以通过<code>git log --show-signature</code>命令查看详细的信息。
至此就配置成功了，当 push 到 GitHub 之后，就可以看到认证了。不过除此之外，关于 GPG 的使用还有一些内容要注意的。</p><h3 id=备份和主密钥的撤销>备份和主密钥的撤销<a hidden class=anchor aria-hidden=true href=#备份和主密钥的撤销>#</a></h3><p>你可以在不同的设备上使用同一份 GPG Key，你可以使用同一个子密钥，也可以生成多个子密钥供不同设备使用。一般来说我们只需要导出主密钥的公钥和私钥即可。输入<code>gpg --armor --export DCA603FF70CDCDD0 > public-key.asc</code>命令导出主密钥公钥，输入<code>gpg --armor --export-secret-keys DCA603FF70CDCDD0 > private-key.asc</code>命令导出主密钥私钥。这将会得到两个文件，这两个文件需要妥善保存，并且可以通过如下的命令在另一台设备导入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>gpg --import public-key.asc
</span></span><span class=line><span class=cl>gpg --import private-key.asc
</span></span></code></pre></div><p>除此之外，最好生成并备份撤销证书，这可以在密钥泄露之后对 GPG Key 进行撤销操作，撤销之后的密钥对就相当于作废了。输入<code>gpg --output revoke.asc --gen-revoke DCA603FF70CDCDD0</code>命令得到<code>revoke.asc</code>文件，即为撤销证书。撤销的命令是<code>gpg --import revoke.asc</code>，注意该操作不可逆，谨慎操作。
另外，撤销和删除是不同的操作，这个命令<code>gpg --delete-keys DCA603FF70CDCDD0</code>会删除主密钥，一般来说只有撤销或者设置密钥不被信任之后才可以删除，否则 gpg 会阻止删除操作。</p><h3 id=子密钥的生成和撤销>子密钥的生成和撤销<a hidden class=anchor aria-hidden=true href=#子密钥的生成和撤销>#</a></h3><p>输入<code>gpg --edit-key DCA603FF70CDCDD0</code>命令，进入一个交互模式，效果如下：</p><pre tabindex=0><code>➜  ~ gpg --edit-key DCA603FF70CDCDD0
gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Secret key is available.

sec  rsa4096/DCA603FF70CDCDD0
     created: 2023-06-03  expires: never       usage: SC
     trust: ultimate      validity: ultimate
ssb  rsa4096/57D615B2EC5D45C1
     created: 2023-06-03  expires: never       usage: E
[ultimate] (1). eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;

gpg&gt;
</code></pre><p>你可以输入 help 查看所有命令，这里我们输入<code>addkey</code>会输出创建主密钥时类似的提示，选择算法：</p><pre tabindex=0><code>gpg&gt; addkey
Please select what kind of key you want:
   (3) DSA (sign only)
   (4) RSA (sign only)
   (5) Elgamal (encrypt only)
   (6) RSA (encrypt only)
  (14) Existing key from card
Your selection?
</code></pre><p>这里就选一个 4 好了，只用于签名，之后的各种提示和前面一样，不做赘述，最终输出如下：</p><pre tabindex=0><code>sec  rsa4096/DCA603FF70CDCDD0
     created: 2023-06-03  expires: never       usage: SC
     trust: ultimate      validity: ultimate
ssb  rsa4096/57D615B2EC5D45C1
     created: 2023-06-03  expires: never       usage: E
ssb  rsa4096/6D27CF5A5037DE52
     created: 2023-06-03  expires: never       usage: S
[ultimate] (1). eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;
</code></pre><p>会发现，多了一个密钥，其中 usage 的值为 S，代表 sign，这就是刚刚生成的子密钥，然后输入<code>save</code>保存并退出，就可以使用了。
如果想要撤销一个子密钥，先进入交互模式<code>gpg --edit-key DCA603FF70CDCDD0</code>，比如我想撤销第二个子密钥，那就输入<code>key 2</code>，会输出：</p><pre tabindex=0><code>gpg&gt; key 2

sec  rsa4096/DCA603FF70CDCDD0
     created: 2023-06-03  expires: never       usage: SC
     trust: ultimate      validity: ultimate
ssb  rsa4096/57D615B2EC5D45C1
     created: 2023-06-03  expires: never       usage: E
ssb* rsa4096/6D27CF5A5037DE52
     created: 2023-06-03  expires: never       usage: S
[ultimate] (1). eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;
</code></pre><p>这里第二个 ssb 后面多个一个星号，代表它被选中了，然后输入<code>revkey</code>回车，经过一系列交互之后得到如下的输出结果：</p><pre tabindex=0><code>gpg&gt; revkey
Do you really want to revoke this subkey? (y/N) y
Please select the reason for the revocation:
  0 = No reason specified
  1 = Key has been compromised
  2 = Key is superseded
  3 = Key is no longer used
  Q = Cancel
Your decision? 0
Enter an optional description; end it with an empty line:
&gt;
Reason for revocation: No reason specified
(No description given)
Is this okay? (y/N) y

sec  rsa4096/DCA603FF70CDCDD0
     created: 2023-06-03  expires: never       usage: SC
     trust: ultimate      validity: ultimate
ssb  rsa4096/57D615B2EC5D45C1
     created: 2023-06-03  expires: never       usage: E
The following key was revoked on 2023-06-03 by RSA key DCA603FF70CDCDD0 eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;
ssb  rsa4096/6D27CF5A5037DE52
     created: 2023-06-03  revoked: 2023-06-03  usage: S
[ultimate] (1). eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;
</code></pre><p>然后输入<code>save</code>回车，就成功撤销了这个子密钥。再次查询列表时会发现该子密钥已经不存在：</p><pre tabindex=0><code>➜  ~ gpg --list-secret-keys --keyid-format LONG
/root/.gnupg/pubring.kbx
------------------------
sec   rsa4096/DCA603FF70CDCDD0 2023-06-03 [SC]
      B1D32AD243FEFF42CCEBF9A9DCA603FF70CDCDD0
uid                 [ultimate] eyebrowkang &lt;48169104+eyebrowkang@users.noreply.github.com&gt;
ssb   rsa4096/57D615B2EC5D45C1 2023-06-03 [E]
</code></pre><p>不过这并没有删除子密钥，如果要删除的话，可以再次进入交互模式并选中对应的子密钥，然后通过<code>delkey</code>命令来删除。</p><h3 id=其他配置>其他配置<a hidden class=anchor aria-hidden=true href=#其他配置>#</a></h3><p>如果是 MacOS，并且想要让设备记住 gpg 密码，那么需要安装<code>pinentry-mac</code>这个包，然后运行<code>echo "pinentry-program $(which pinentry-mac)" >> ~/.gnupg/gpg-agent.conf</code>命令，并重启 gpg-agent。</p><p>如果仅需要在 git 的 submodule 中设置签名，那么就先进入该 submodule，然后运行<code>git config user.signingkey 57D615B2EC5D45C1</code>即可。</p><h3 id=常用命令汇总>常用命令汇总<a hidden class=anchor aria-hidden=true href=#常用命令汇总>#</a></h3><pre tabindex=0><code>gpg --full-generate-key
gpg --list-keys
gpg --list-secret-keys --keyid-format LONG
gpg --armor --export &lt;key-id&gt;
gpg --output revoke.asc --gen-revoke &lt;key-id&gt;
gpg --edit-key &lt;key-id&gt;
gpg --armor --export &lt;key-id&gt; &gt; public-key.asc
gpg --armor --export-secret-keys &lt;key-id&gt; &gt; private-key.asc
gpg --import public-key.asc
gpg --import private-key.asc
gpg --delete-keys &lt;key-id&gt;
gpg --delete-secret-keys &lt;key-id&gt;

git config user.signingkey &lt;key-id&gt;
git config commit.gpgsign true
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://tech.eyebrowkang.com/tags/github/>github</a></li><li><a href=https://tech.eyebrowkang.com/tags/gnupg/>gnupg</a></li><li><a href=https://tech.eyebrowkang.com/tags/ssh/>ssh</a></li></ul><nav class=paginav><a class=next href=https://tech.eyebrowkang.com/posts/2023-05-16-eslint%E5%92%8Cprettier%E9%85%8D%E7%BD%AE/><span class=title>下一页 »</span><br><span>ESLint和Prettier配置</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 配置你的GitHub(包括SSH和GPG) on x" href="https://x.com/intent/tweet/?text=%e9%85%8d%e7%bd%ae%e4%bd%a0%e7%9a%84GitHub%28%e5%8c%85%e6%8b%acSSH%e5%92%8cGPG%29&amp;url=https%3a%2f%2ftech.eyebrowkang.com%2fposts%2f2023-06-03-%25E9%2585%258D%25E7%25BD%25AE%25E4%25BD%25A0%25E7%259A%2584github%25E5%258C%2585%25E6%258B%25ACssh%25E5%2592%258Cgpg%2f&amp;hashtags=github%2cgnupg%2cssh"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 配置你的GitHub(包括SSH和GPG) on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ftech.eyebrowkang.com%2fposts%2f2023-06-03-%25E9%2585%258D%25E7%25BD%25AE%25E4%25BD%25A0%25E7%259A%2584github%25E5%258C%2585%25E6%258B%25ACssh%25E5%2592%258Cgpg%2f&title=%e9%85%8d%e7%bd%ae%e4%bd%a0%e7%9a%84GitHub%28%e5%8c%85%e6%8b%acSSH%e5%92%8cGPG%29"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 配置你的GitHub(包括SSH和GPG) on telegram" href="https://telegram.me/share/url?text=%e9%85%8d%e7%bd%ae%e4%bd%a0%e7%9a%84GitHub%28%e5%8c%85%e6%8b%acSSH%e5%92%8cGPG%29&amp;url=https%3a%2f%2ftech.eyebrowkang.com%2fposts%2f2023-06-03-%25E9%2585%258D%25E7%25BD%25AE%25E4%25BD%25A0%25E7%259A%2584github%25E5%258C%2585%25E6%258B%25ACssh%25E5%2592%258Cgpg%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://tech.eyebrowkang.com>Share Some Tech</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>